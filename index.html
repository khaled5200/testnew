<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نموذج إدخال البيانات</title>
</head>
<body>
    <form id="shipment-form">
        <label for="date">التاريخ:</label>
        <input type="text" id="date" name="date" required><br>

        <label for="month-year">الشهر والسنة:</label>
        <input type="text" id="month-year" name="month-year" required><br>

        <label for="name">الاسم:</label>
        <input type="text" id="name" name="name" required><br>

        <label for="vehicle-number">رقم السيارة:</label>
        <input type="text" id="vehicle-number" name="vehicle-number" required><br>

        <label for="route-number">رقم الرحلة:</label>
        <input type="text" id="route-number" name="route-number" required><br>

        <label for="cycle-number">رقم الدورة:</label>
        <input type="text" id="cycle-number" name="cycle-number" required><br>

        <label for="cash">النقدي:</label>
        <input type="number" id="cash" name="cash" required><br>

        <label for="total-shipments">إجمالي الشحنات:</label>
        <input type="number" id="total-shipments" name="total-shipments" required><br>

        <label for="delivered-shipments">الشحنات الموصلة:</label>
        <input type="number" id="delivered-shipments" name="delivered-shipments" required><br>

        <label for="returned-shipments">الشحنات المرتجعة:</label>
        <input type="number" id="returned-shipments" name="returned-shipments" required><br>

        <label for="returned-reason">سبب الإرجاع:</label>
        <input type="text" id="returned-reason" name="returned-reason"><br>

        <label for="helped-colleague">هل ساعدت زميلًا؟</label>
        <input type="checkbox" id="helped-colleague" name="helped-colleague"><br>

        <label for="colleague-name">اسم الزميل:</label>
        <input type="text" id="colleague-name" name="colleague-name"><br>

        <label for="received-shipments">الشحنات المستلمة:</label>
        <input type="number" id="received-shipments" name="received-shipments"><br>

        <label for="received-delivered-shipments">الشحنات المستلمة والموصلة:</label>
        <input type="number" id="received-delivered-shipments" name="received-delivered-shipments"><br>

        <label for="helper-name">اسم المساعد:</label>
        <input type="text" id="helper-name" name="helper-name"><br>

        <label for="helper-delivered-shipments">الشحنات الموصلة بواسطة المساعد:</label>
        <input type="number" id="helper-delivered-shipments" name="helper-delivered-shipments"><br>

        <button type="submit">حفظ البيانات</button>
    </form>

    <script>
        const form = document.getElementById('shipment-form');

        // عند إرسال النموذج
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            validateShipments();

            // جمع البيانات المدخلة في النموذج
            const formData = new FormData(form);

            // استخراج القيم
            const date = formData.get('date');
            const monthYear = formData.get('month-year');
            const name = formData.get('name');
            const vehicleNumber = formData.get('vehicle-number');
            const routeNumber = formData.get('route-number');
            const cycleNumber = formData.get('cycle-number');
            const cash = formData.get('cash');
            const totalShipments = formData.get('total-shipments');
            const deliveredShipments = formData.get('delivered-shipments');
            const returnedShipments = formData.get('returned-shipments');
            const returnedReason = [];
            const helpedColleague = formData.get('helped-colleague');
            const colleagueName = formData.get('colleague-name');
            const receivedShipments = formData.get('received-shipments');
            const receivedDeliveredShipments = formData.get('received-delivered-shipments');
            const helperName = formData.get('helper-name');
            const helperDeliveredShipments = formData.get('helper-delivered-shipments');

            // جمع أسباب الشحنات المرتجعة
            for (let i = 1; i <= returnedShipments; i++) {
                returnedReason.push(formData.get(`returned-reason-${i}`));
            }

            // إعداد البيانات للإرسال إلى السيرفر
            const data = {
                date,
                monthYear,
                name,
                vehicleNumber,
                routeNumber,
                cycleNumber,
                cash,
                totalShipments,
                deliveredShipments,
                returnedShipments,
                returnedReason,
                helpedColleague,
                colleagueName,
                receivedShipments,
                receivedDeliveredShipments,
                helperName,
                helperDeliveredShipments,
            };

            // إرسال البيانات باستخدام fetch إلى السكربت الذي يعالج البيانات
            fetch('https://script.google.com/macros/s/AKfycbzc1EdbkvTHQKNMEILgYSBrdjj9klaeMiqSL_RzItBosiV3ocJFcV8bBEm8Yn1u3cbn6w/exec', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                alert('تم حفظ البيانات بنجاح!');
                form.reset(); // إعادة تعيين النموذج بعد الحفظ
            })
            .catch(error => {
                console.error('حدث خطأ:', error);
                alert('حدث خطأ أثناء حفظ البيانات.');
            });
        });

        // تحقق من صحة الشحنات
        function validateShipments() {
            // التحقق من أن الشحنات الموصلة لا تتجاوز الإجمالي
            const deliveredShipments = parseInt(document.getElementById('delivered-shipments').value);
            const totalShipments = parseInt(document.getElementById('total-shipments').value);
            if (deliveredShipments > totalShipments) {
                alert('عدد الشحنات الموصلة لا يمكن أن يتجاوز إجمالي الشحنات.');
            }
        }
    </script>
</body>
</html>
